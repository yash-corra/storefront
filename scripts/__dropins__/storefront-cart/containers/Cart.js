import{jsx as e,jsxs as o,Fragment as d}from"@dropins/tools/preact-jsx-runtime.js";import{useState as j,useEffect as M}from"@dropins/tools/preact-compat.js";import{classes as p,VComponent as D,Slot as K}from"@dropins/tools/lib.js";import{events as Y}from"@dropins/tools/event-bus.js";import{Divider as Z,InLineAlert as m,Icon as X,CartList as R,CartItem as F,Image as Q,Price as c}from"@dropins/tools/components.js";/* empty css                    */import{S as rr,a as U,E as er}from"../chunks/EmptyCart.js";import{s as H,i as tr}from"../chunks/resetCart.js";import{b as nr,u as ar}from"../chunks/updateProductsFromCart.js";import{useText as cr}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/CartFragment.js";const ir=({className:x,children:h,emptyCart:g,heading:l,products:s,orderSummary:y,outOfStockMessage:a,...E})=>e("div",{...E,className:p(["cart-cart",x]),children:o("div",{className:p(["cart-cart__wrapper"]),children:[l&&o("div",{className:p(["cart-cart__heading",["cart-cart__heading--full-width",!s||!y]]),children:[e(D,{node:l,className:"cart-cart__heading-text"}),e(Z,{variant:"primary",className:p(["cart-cart__heading-divider"])}),a&&e(D,{node:a,className:"cart-cart__out-of-stock-message"})]}),e("div",{className:p(["cart-cart__content",["cart-cart__content--empty",!s],["cart-cart__content--full-width",!y]]),children:s||e(D,{node:g,className:"cart-cart__empty-cart"})}),s&&y&&e(D,{node:y,className:p(["cart-cart__order-summary"])})]})}),lr=({children:x,slots:h,initialData:g=null,routeProduct:l,routeEmptyCartCTA:s,...y})=>{var q;const[a,E]=j(g),[T,V]=j(new Set),z=(r,i)=>{V(u=>(i?u.add(r):u.delete(r),new Set(u)))},f=(r,i)=>{z(r,!0),ar([{uid:r,quantity:i}]).catch(u=>{console.warn(u)}).finally(()=>{z(r,!1)})},t=cr({discountedPrice:"Cart.CartItem.discountedPrice",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",orderSummary:"Cart.PriceSummary.orderSummary",regularPrice:"Cart.CartItem.regularPrice",recipient:"Cart.CartItem.recipient",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files",lowInventory:"Cart.CartItem.lowInventory",insufficientQuantity:"Cart.CartItem.insufficientQuantity",insufficientQuantityGeneral:"Cart.CartItem.insufficientQuantityGeneral",outOfStockHeading:"Cart.OutOfStockMessage.heading",outOfStockDescription:"Cart.OutOfStockMessage.message",outOfStockAlert:"Cart.OutOfStockMessage.alert",removeAction:"Cart.OutOfStockMessage.action"});M(()=>{const r=Y.on("cart/data",i=>{E(i)},{eager:!0});return()=>{r==null||r.off()}},[]),M(()=>{g&&Object.keys(g).length>0&&nr(g,H.locale??"en-US")},[g]);const n=(q=H.config)==null?void 0:q.shoppingCartDisplaySetting,W=h!=null&&h.OrderSummary?e(K,{name:"OrderSummary",slot:h.OrderSummary}):void 0,$=a!=null&&a.totalQuantity?a.totalQuantity.toString():"",B=()=>{const r=a==null?void 0:a.items.filter(i=>i.outOfStock);r==null||r.forEach(i=>{f(i.uid,0)})},J=e(m,{"data-testid":"out-of-stock-message",icon:e(X,{source:rr,size:"16"}),itemList:(a==null?void 0:a.totalQuantity)??0?e(R,{children:a==null?void 0:a.items.filter(r=>r.outOfStock||r.insufficientQuantity).map((r,i)=>{var v,k,S,w,N,O,L,_,C,b,P,G;const u=T.has(r.uid),I={...r.bundleOptions??{},...r.selectedOptions??{},...r.customizableOptions,...r.recipient?{[t.recipient]:r.recipient}:{},...r.recipientEmail&&r.recipient?{[t.recipient]:`${r.recipient} (${r.recipientEmail})`}:{},...r.sender?{[t.sender]:r.sender}:{},...r.senderEmail&&r.sender?{[t.sender]:`${r.sender} (${r.senderEmail})`}:{},...r.message?{[t.message]:r.message}:{},...r.links&&r.links.count?r.links.count>1?{[t.files.replace("{count}",r.links.count.toString())]:r.links.result}:{[t.file.replace("{count}",r.links.count.toString())]:r.links.result}:{}};return e(F,{"data-testid":"cart-item",ariaLabel:r.name,updating:u,taxIncluded:(n==null?void 0:n.price)==="INCLUDING_TAX",taxExcluded:(n==null?void 0:n.price)==="INCLUDING_EXCLUDING_TAX",warning:!r.outOfStock&&(r.insufficientQuantity||r.lowInventory)?o("span",{"data-testid":"inline-warning",children:[e(X,{source:U,size:"16"}),r.insufficientQuantity&&r.stockLevel&&(r.stockLevel==="noNumber"?t.insufficientQuantityGeneral:t.insufficientQuantity.replace("{inventory}",(v=r.stockLevel)==null?void 0:v.toString()).replace("{count}",r.quantity.toString()))||r.lowInventory&&r.onlyXLeftInStock&&t.lowInventory.replace("{count}",(k=r.onlyXLeftInStock)==null?void 0:k.toString())]}):void 0,alert:r.outOfStock?o("span",{children:[e(X,{source:U,size:"16"}),t.outOfStockAlert]}):void 0,image:l?e("a",{href:l(r),children:e(Q,{loading:i<4?"eager":"lazy",src:r.image.src,alt:r.image.alt,width:"300",height:"300",params:{width:300}})}):e(Q,{loading:i<4?"eager":"lazy",src:r.image.src,alt:r.image.alt,width:"300",height:"300",params:{width:300}}),title:e("span",{children:l?e("a",{href:l(r),children:r.name}):e(d,{children:r.name})}),sku:e("span",{children:r.sku}),configurations:Object.keys(I).length>0?I:void 0,quantity:r.quantity,price:(n==null?void 0:n.price)==="INCLUDING_TAX"?e(c,{amount:r.discounted?(S=r.regularPrice)==null?void 0:S.value:(w=r.taxedPrice)==null?void 0:w.value,currency:r.discounted?(N=r.regularPrice)==null?void 0:N.currency:(O=r.taxedPrice)==null?void 0:O.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}):e(c,{amount:(L=r.regularPrice)==null?void 0:L.value,currency:(_=r.regularPrice)==null?void 0:_.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}),total:(n==null?void 0:n.price)==="INCLUDING_EXCLUDING_TAX"||(n==null?void 0:n.price)==="INCLUDING_TAX"?e(d,{children:r.discounted?o(d,{children:[e(c,{amount:r.total.value,currency:r.total.currency,variant:r.discounted?"strikethrough":"default","data-testid":"including-tax-row-total","aria-label":t.regularPrice}),e(c,{amount:(C=r.rowTotalIncludingTax)==null?void 0:C.value,currency:(b=r.rowTotalIncludingTax)==null?void 0:b.currency,sale:r.discounted,"data-testid":"discount-total","aria-label":t.discountedPrice})]}):e(c,{amount:r.rowTotalIncludingTax.value,currency:r.rowTotalIncludingTax.currency,"data-testid":"including-tax-row-total","aria-label":t.regularPrice})}):o(d,{children:[e(c,{amount:r.total.value,currency:r.total.currency,variant:r.discounted?"strikethrough":"default","data-testid":"regular-total","aria-label":t.regularPrice}),r.discounted&&e(c,{amount:(P=r.discountedTotal)==null?void 0:P.value,currency:(G=r.discountedTotal)==null?void 0:G.currency,sale:r.discounted,"data-testid":"discount-total","aria-label":t.discountedPrice})]}),totalExcludingTax:(n==null?void 0:n.price)==="INCLUDING_EXCLUDING_TAX"?e(c,{amount:r.rowTotal.value,currency:r.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":t.regularPrice}):void 0,onQuantity:A=>{f(r.uid,A)},onRemove:()=>{f(r.uid,0)}},r.uid)})}):void 0,type:"warning",heading:t.outOfStockHeading,description:t.outOfStockDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:a!=null&&a.hasFullyOutOfStockItems?[{label:t.removeAction,onClick:B}]:void 0});return e(ir,{...y,heading:e("div",{children:t.heading.replace("({count})",$?`(${$})`:"")}),emptyCart:e(er,{ctaLinkURL:s==null?void 0:s()}),orderSummary:W,outOfStockMessage:a!=null&&a.hasOutOfStockItems?J:void 0,products:(a==null?void 0:a.totalQuantity)??0?e(R,{children:a==null?void 0:a.items.filter(r=>!r.outOfStock&&!r.insufficientQuantity).map((r,i)=>{var v,k,S,w,N,O,L,_,C,b,P,G;const u=T.has(r.uid),I={...r.bundleOptions??{},...r.selectedOptions??{},...r.customizableOptions,...r.recipient?{[t.recipient]:r.recipient}:{},...r.recipientEmail&&r.recipient?{[t.recipient]:`${r.recipient} (${r.recipientEmail})`}:{},...r.sender?{[t.sender]:r.sender}:{},...r.senderEmail&&r.sender?{[t.sender]:`${r.sender} (${r.senderEmail})`}:{},...r.message?{[t.message]:r.message}:{},...r.links&&r.links.count?r.links.count>1?{[t.files.replace("{count}",r.links.count.toString())]:r.links.result}:{[t.file.replace("{count}",r.links.count.toString())]:r.links.result}:{}};return e(F,{ariaLabel:r.name,updating:u,"data-testid":"cart-item",taxIncluded:(n==null?void 0:n.price)==="INCLUDING_TAX",taxExcluded:(n==null?void 0:n.price)==="INCLUDING_EXCLUDING_TAX",warning:!r.outOfStock&&(r.insufficientQuantity||r.lowInventory)?o("span",{children:[e(X,{source:U,size:"16"}),r.insufficientQuantity&&r.stockLevel&&(r.stockLevel==="noNumber"?t.insufficientQuantityGeneral:t.insufficientQuantity.replace("{inventory}",(v=r.stockLevel)==null?void 0:v.toString()).replace("{count}",r.quantity.toString()))||r.lowInventory&&r.onlyXLeftInStock&&t.lowInventory.replace("{count}",(k=r.onlyXLeftInStock)==null?void 0:k.toString())]}):void 0,alert:r.outOfStock?o("span",{children:[e(X,{source:U,size:"16"}),t.outOfStockAlert]}):void 0,image:l?e("a",{href:l(r),children:e(Q,{loading:i<4?"eager":"lazy",src:r.image.src,alt:r.image.alt,width:"300",height:"300",params:{width:300}})}):e(Q,{loading:i<4?"eager":"lazy",src:r.image.src,alt:r.image.alt,width:"300",height:"300",params:{width:300}}),title:e("span",{children:l?e("a",{href:l(r),children:r.name}):e(d,{children:r.name})}),sku:e("span",{children:r.sku}),configurations:Object.keys(I).length>0?I:void 0,quantity:r.quantity,price:(n==null?void 0:n.price)==="INCLUDING_TAX"?e(c,{amount:r.discounted?(S=r.regularPrice)==null?void 0:S.value:(w=r.taxedPrice)==null?void 0:w.value,currency:r.discounted?(N=r.regularPrice)==null?void 0:N.currency:(O=r.taxedPrice)==null?void 0:O.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}):e(c,{amount:(L=r.regularPrice)==null?void 0:L.value,currency:(_=r.regularPrice)==null?void 0:_.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}),total:(n==null?void 0:n.price)==="INCLUDING_EXCLUDING_TAX"||(n==null?void 0:n.price)==="INCLUDING_TAX"?e(d,{children:r.discounted?o(d,{children:[e(c,{amount:r.total.value,currency:r.total.currency,variant:r.discounted?"strikethrough":"default","data-testid":"including-tax-row-total","aria-label":t.regularPrice}),e(c,{amount:(C=r.rowTotalIncludingTax)==null?void 0:C.value,currency:(b=r.rowTotalIncludingTax)==null?void 0:b.currency,sale:r.discounted,"data-testid":"discount-total","aria-label":t.discountedPrice})]}):e(c,{amount:r.rowTotalIncludingTax.value,currency:r.rowTotalIncludingTax.currency,"data-testid":"including-tax-row-total","aria-label":t.regularPrice})}):o(d,{children:[e(c,{amount:r.total.value,currency:r.total.currency,variant:r.discounted?"strikethrough":"default","data-testid":"regular-total","aria-label":t.regularPrice}),r.discounted&&e(c,{amount:(P=r.discountedTotal)==null?void 0:P.value,currency:(G=r.discountedTotal)==null?void 0:G.currency,sale:r.discounted,"data-testid":"discount-total","aria-label":t.discountedPrice})]}),totalExcludingTax:(n==null?void 0:n.price)==="INCLUDING_EXCLUDING_TAX"?e(c,{amount:r.rowTotal.value,currency:r.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":t.regularPrice}):void 0,onQuantity:A=>{f(r.uid,A)},onRemove:()=>{f(r.uid,0)}},r.uid)})}):void 0})};lr.getInitialData=async function(){return tr()};export{lr as Cart,lr as default};
