import{jsxs as d,jsx as t,Fragment as M}from"@dropins/tools/preact-jsx-runtime.js";import*as j from"@dropins/tools/preact-compat.js";import{useState as V,useEffect as J}from"@dropins/tools/preact-compat.js";import{classes as l,VComponent as y,Slot as rr}from"@dropins/tools/lib.js";import{events as K}from"@dropins/tools/event-bus.js";import{s as er,i as tr}from"../chunks/resetCart.js";import{g as ar}from"../chunks/getEstimatedTotals.js";import{Accordion as ir,AccordionSection as cr,ProgressSpinner as nr,Divider as mr,Price as s,Button as ur}from"@dropins/tools/components.js";/* empty css                    */import{useText as Y}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/CartFragment.js";const or=()=>{const[x,D]=V(!1),[T,h]=V();return{handleEstimateTotals:(r,p)=>{D(!0);const{shippingCountry:_,shippingState:e="",shippingZip:S=""}=r,a={countryCode:_,postcode:S,region:{region:e},shipping_method:{carrier_code:(p==null?void 0:p.carrier_code)||"",method_code:(p==null?void 0:p.method_code)||""}};ar(a).then(i=>{var B,C,v,u,P,N,w,I,k,E,L,o,O,W,A,G,c,n,U,X;i&&h({estimatedTaxTotal:{amount:(B=i.totalTax)==null?void 0:B.value,currency:(C=i.totalTax)==null?void 0:C.currency},estimatedSubTotal:{excludingTax:{amount:(u=(v=i.subtotal)==null?void 0:v.excludingTax)==null?void 0:u.value,currency:(N=(P=i.subtotal)==null?void 0:P.excludingTax)==null?void 0:N.currency},includingTax:{amount:(I=(w=i.subtotal)==null?void 0:w.includingTax)==null?void 0:I.value,currency:(E=(k=i.subtotal)==null?void 0:k.includingTax)==null?void 0:E.currency},includingDiscountOnly:{amount:(o=(L=i.subtotal)==null?void 0:L.includingDiscountOnly)==null?void 0:o.value,currency:(W=(O=i.subtotal)==null?void 0:O.includingDiscountOnly)==null?void 0:W.currency}},estimatedGrandTotalPrice:{includingTax:{amount:(A=i.total)==null?void 0:A.includingTax.value,currency:(G=i.total)==null?void 0:G.includingTax.currency},excludingTax:{amount:(c=i.total)==null?void 0:c.excludingTax.value,currency:(n=i.total)==null?void 0:n.excludingTax.currency}},estimatedAppliedTaxes:{taxes:(U=i.appliedTaxes)==null?void 0:U.map(m=>{var g,b;return{label:m.label,amount:{value:(g=m.amount)==null?void 0:g.value,currency:(b=m.amount)==null?void 0:b.currency}}})},estimatedItems:{items:(X=i.items)==null?void 0:X.map(m=>{var g,b,z,F,Z,q,$,Q,R,H;return{uid:m.uid,price:{amount:(g=m.price)==null?void 0:g.value,currency:(b=m.price)==null?void 0:b.currency},taxedPrice:{amount:(z=m.taxedPrice)==null?void 0:z.value,currency:(F=m.taxedPrice)==null?void 0:F.currency},rowTotal:{amount:(Z=m.rowTotal)==null?void 0:Z.value,currency:(q=m.rowTotal)==null?void 0:q.currency},rowTotalIncludingTax:{amount:($=m.rowTotalIncludingTax)==null?void 0:$.value,currency:(Q=m.rowTotalIncludingTax)==null?void 0:Q.currency},regularPrice:{amount:(R=m.regularPrice)==null?void 0:R.value,currency:(H=m.regularPrice)==null?void 0:H.currency}}})}})}).finally(()=>{D(!1)})},estimatedTotals:T,loading:x}},lr=x=>j.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...x},j.createElement("path",{d:"M7.74512 9.87701L12.0001 14.132L16.2551 9.87701",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),sr=x=>j.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...x},j.createElement("path",{d:"M7.74512 14.132L12.0001 9.87701L16.2551 14.132",stroke:"#2B2B2B",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),dr=({className:x,children:D,variant:T="primary",heading:h,loading:f=!0,subTotal:r,shipping:p,discounts:_,taxTotal:e,taxesApplied:S,total:a,primaryAction:i,...B})=>{const[C,v]=V(!1),u=Y({checkout:"Cart.PriceSummary.checkout",discountedPrice:"Cart.CartItem.discountedPrice",download:"Cart.CartItem.download",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",regularPrice:"Cart.CartItem.regularPrice",recipient:"Cart.CartItem.recipient",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files",orderSummary:"Cart.PriceSummary.orderSummary",taxesBreakdownTitle:"Cart.PriceSummary.taxes.breakdown",taxTotal:"Cart.PriceSummary.taxes.total",taxEstimated:"Cart.PriceSummary.taxes.estimated",taxTotalOnly:"Cart.PriceSummary.taxes.totalOnly",showTaxBreakdown:"Cart.PriceSummary.taxes.showBreakdown",hideTaxBreakdown:"Cart.PriceSummary.taxes.hideBreakdown",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined",subtotalLabel:"Cart.PriceSummary.subTotal.label",subtotalWithTaxes:"Cart.PriceSummary.subTotal.withTaxes",subtotalWithoutTaxes:"Cart.PriceSummary.subTotal.withoutTaxes",totalEstimated:"Cart.PriceSummary.total.estimated",totalLabel:"Cart.PriceSummary.total.label",totalWithoutTax:"Cart.PriceSummary.total.withoutTax",shippingLabel:"Cart.PriceSummary.shipping.label",zipPlaceholder:"Cart.PriceSummary.shipping.zipPlaceholder",editZipAction:"Cart.PriceSummary.shipping.editZipAction",shippingWithTaxes:"Cart.PriceSummary.shipping.withTaxes",shippingWithoutTaxes:"Cart.PriceSummary.shipping.withoutTaxes",shippingEstimated:"Cart.PriceSummary.shipping.estimated",shippingEstimatedByState:"Cart.PriceSummary.shipping.alternateField.state",shippingEstimatedByZip:"Cart.PriceSummary.shipping.alternateField.zip",destinationLinkAriaLabel:"Cart.PriceSummary.shipping.destinationLinkAriaLabel",applyButton:"Cart.PriceSummary.estimatedShippingForm.apply.label",countryField:"Cart.PriceSummary.estimatedShippingForm.country.placeholder",freeShipping:"Cart.PriceSummary.freeShipping",stateField:"Cart.PriceSummary.estimatedShippingForm.state.placeholder",zipField:"Cart.PriceSummary.estimatedShippingForm.zip.placeholder"}),P=r&&d("div",{className:l(["cart-order-summary__entry","cart-order-summary__subTotal"]),children:[t("span",{className:"cart-order-summary__label",children:u.subtotalLabel}),t(y,{node:r.price,className:"cart-order-summary__price"}),r.taxIncluded&&t("div",{"data-testid":"sub-total-tax-caption",className:"cart-order-summary__caption",children:t("span",{children:u.subtotalWithTaxes})}),r.taxExcluded?t("div",{"data-testid":"sub-total-tax-caption-excluded",className:"cart-order-summary__caption",children:d("span",{children:[r.priceExcludingTax,"Â ",u.subtotalWithoutTaxes]})}):void 0]}),N=p&&t(y,{node:p,className:"cart-order-summary__shipping"}),w=_&&_.length>0&&t(M,{children:_.map(o=>d("div",{className:l(["cart-order-summary__entry","cart-order-summary__discount"]),children:[t("span",{className:"cart-order-summary__label",children:o.label}),t(y,{node:o.price,className:"cart-order-summary__price"}),o.caption&&t(y,{node:o.caption,className:"cart-order-summary__caption"})]},o.label))}),I=S&&S.length>0?t(ir,{"data-testid":"tax-breakdown",className:"cart-order-summary__taxes",iconOpen:lr,iconClose:sr,children:d(cr,{title:u.taxesBreakdownTitle,secondaryText:!C&&e?t(y,{node:e.price,className:"cart-order-summary__price"}):void 0,renderContentWhenClosed:!1,onStateChange:v,children:[t("div",{className:"cart-order-summary__appliedTaxes",children:S.map(o=>d("div",{className:l(["cart-order-summary__entry","cart-order-summary__taxEntry"]),children:[t("span",{className:l(["cart-order-summary__label","cart-order-summary__label--muted"]),children:o.label}),t(y,{node:o.price,className:l(["cart-order-summary__price","cart-order-summary__price--muted"])})]},o.label))}),d("div",{className:l(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[t("span",{className:"cart-order-summary__label",children:u.taxTotal}),e&&t(y,{node:e.price,className:"cart-order-summary__price"})]})]})}):e&&d("div",{"data-testid":"tax-total-only",className:l(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[t("span",{className:"cart-order-summary__label",children:e.estimated?u.taxEstimated:u.taxTotalOnly}),t(y,{node:e.price,className:"cart-order-summary__price"})]}),k=a&&d("div",{"data-testid":"total-content",className:l(["cart-order-summary__entry","cart-order-summary__total",a.estimated&&"cart-order-summary__total--padded"]),children:[t("span",{className:l(["cart-order-summary__label","cart-order-summary__label--bold"]),children:a.estimated?u.totalEstimated:u.totalLabel}),t(y,{node:a.price,className:l(["cart-order-summary__price","cart-order-summary__price--bold"])})]}),E=a&&a.priceWithoutTax&&d("div",{"data-testid":"total-without-tax",className:l(["cart-order-summary__entry","cart-order-summary__totalWithoutTax"]),children:[t("span",{className:l(["cart-order-summary__label","cart-order-summary__label--muted"]),children:u.totalWithoutTax}),t(y,{node:a.priceWithoutTax,className:l(["cart-order-summary__price","cart-order-summary__price--muted"])})]}),L=i&&t("div",{className:l(["cart-order-summary__entry","cart-order-summary__primaryAction"]),children:i});return d("div",{...B,className:l(["cart-order-summary",["cart-order-summary--loading",f],[`cart-order-summary__${T}`,T],x]),children:[f&&t(nr,{className:"cart-order-summary__spinner"}),d("div",{className:"cart-order-summary__heading",children:[h&&t(y,{node:h,className:"cart-order-summary__heading-text"}),t(mr,{variant:"primary",className:"cart-order-summary__divider-primary"})]}),d("div",{className:"cart-order-summary__content",children:[P,N,w,I,k,E,L]})]})},pr=({children:x,initialData:D=null,routeCheckout:T,slots:h,...f})=>{var C,v,u,P,N,w,I,k,E,L,o,O,W,A,G;const[r,p]=V(D),{handleEstimateTotals:_,estimatedTotals:e,loading:S}=or(),a=(C=er.config)==null?void 0:C.shoppingCartDisplaySetting;J(()=>{const c=K.on("cart/data",n=>{p(n)},{eager:!0});return()=>{c==null||c.off()}},[]),J(()=>{const c=K.on("shipping/estimate",n=>{var m,g,b,z,F;const U={shippingCountry:(m=n==null?void 0:n.address)==null?void 0:m.countryCode,shippingState:(g=n==null?void 0:n.address)==null?void 0:g.region,shippingZip:(b=n==null?void 0:n.address)==null?void 0:b.postCode},X={carrier_code:((z=n==null?void 0:n.shippingMethod)==null?void 0:z.carrierCode)||"",method_code:((F=n==null?void 0:n.shippingMethod)==null?void 0:F.methodCode)||""};_(U,X)});return()=>{c==null||c.off()}},[_]);const i=Y({checkout:"Cart.PriceSummary.checkout",orderSummary:"Cart.PriceSummary.orderSummary",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined"}),B=!(r!=null&&r.isVirtual)&&(h!=null&&h.EstimateShipping)?t(rr,{name:"EstimateShipping",slot:h.EstimateShipping},"estimateShippingId"):void 0;return!Object.keys(r??{}).length||(r==null?void 0:r.totalQuantity)===0?null:t(dr,{...f,"data-testid":"cart-order-summary",heading:t("div",{children:i.orderSummary}),shipping:B,loading:S,subTotal:{taxIncluded:(a==null?void 0:a.subtotal)==="INCLUDING_TAX"&&!(a!=null&&a.zeroTax),taxExcluded:(a==null?void 0:a.subtotal)==="INCLUDING_EXCLUDING_TAX",zeroTaxSubtotal:a==null?void 0:a.zeroTax,priceExcludingTax:(v=e==null?void 0:e.estimatedSubTotal)!=null&&v.excludingTax?t(s,{"data-testid":"subtotal",...(u=e==null?void 0:e.estimatedSubTotal)==null?void 0:u.excludingTax}):t(s,{"data-testid":"subtotal",amount:(P=r==null?void 0:r.subtotal.excludingTax)==null?void 0:P.value,currency:(N=r==null?void 0:r.subtotal.excludingTax)==null?void 0:N.currency}),price:!(a!=null&&a.zeroTax)&&(a==null?void 0:a.subtotal)==="INCLUDING_TAX"||!(a!=null&&a.zeroTax)&&(a==null?void 0:a.subtotal)==="INCLUDING_EXCLUDING_TAX"?(w=e==null?void 0:e.estimatedSubTotal)!=null&&w.includingTax?t(s,{"data-testid":"subtotal",...(I=e==null?void 0:e.estimatedSubTotal)==null?void 0:I.includingTax}):t(s,{"data-testid":"subtotal",amount:(k=r==null?void 0:r.subtotal.includingTax)==null?void 0:k.value,currency:(E=r==null?void 0:r.subtotal.includingTax)==null?void 0:E.currency}):t(s,{"data-testid":"subtotal",amount:(L=r==null?void 0:r.subtotal.excludingTax)==null?void 0:L.value,currency:(o=r==null?void 0:r.subtotal.excludingTax)==null?void 0:o.currency})},discounts:r==null?void 0:r.appliedDiscounts.map(c=>({label:c.label,price:t(s,{"data-testid":"summary-discount-total",amount:-c.amount.value,currency:c.amount.currency,sale:!0})})),taxTotal:r!=null&&r.isVirtual?{price:t("span",{"data-testid":"tax-total",children:i.taxToBeDetermined})}:{price:e!=null&&e.estimatedTaxTotal?t(s,{"data-testid":"tax-total",...e==null?void 0:e.estimatedTaxTotal}):r!=null&&r.totalTax?t(s,{"data-testid":"tax-total",amount:(O=r==null?void 0:r.totalTax)==null?void 0:O.value,currency:(W=r==null?void 0:r.totalTax)==null?void 0:W.currency}):t("span",{"data-testid":"tax-total",children:i.taxToBeDetermined}),estimated:!!(e!=null&&e.estimatedTaxTotal)},taxesApplied:r!=null&&r.isVirtual?void 0:a!=null&&a.fullSummary&&(e!=null&&e.estimatedAppliedTaxes)?(G=(A=e==null?void 0:e.estimatedAppliedTaxes)==null?void 0:A.taxes)==null?void 0:G.map(c=>({label:c.label,price:t(s,{"data-testid":"applied-taxes",amount:c.amount.value,currency:c.amount.currency})})):a!=null&&a.fullSummary?r==null?void 0:r.appliedTaxes.map(c=>({label:c.label,price:t(s,{"data-testid":"applied-taxes",amount:c.amount.value,currency:c.amount.currency})})):void 0,total:{price:e!=null&&e.estimatedGrandTotalPrice?t(s,{...e==null?void 0:e.estimatedGrandTotalPrice.includingTax}):t(s,{amount:r==null?void 0:r.total.includingTax.value,currency:r==null?void 0:r.total.includingTax.currency}),estimated:!!(e!=null&&e.estimatedGrandTotalPrice),priceWithoutTax:a!=null&&a.grandTotal?e!=null&&e.estimatedAppliedTaxes?t(s,{...e==null?void 0:e.estimatedGrandTotalPrice.excludingTax}):t(s,{amount:r==null?void 0:r.total.excludingTax.value,currency:r==null?void 0:r.total.excludingTax.currency}):void 0},primaryAction:T&&t(ur,{"data-testid":"checkout-button",variant:"primary",disabled:r==null?void 0:r.hasOutOfStockItems,"aria-disabled":r==null?void 0:r.hasOutOfStockItems,href:r!=null&&r.hasOutOfStockItems?void 0:T({cartId:r.id}),children:i.checkout})})};pr.getInitialData=async function(){return tr()};export{pr as OrderSummary,pr as default};
