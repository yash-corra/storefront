import{jsxs as l,jsx as e,Fragment as u}from"@dropins/tools/preact-jsx-runtime.js";import{useState as m,useEffect as q}from"@dropins/tools/preact-compat.js";import{s as j,i as K}from"../chunks/resetCart.js";import{events as Y}from"@dropins/tools/event-bus.js";import{classes as R,VComponent as p}from"@dropins/tools/lib.js";import{Divider as Z,InLineAlert as tt,Icon as G,CartList as F,CartItem as B,Image as P,Price as c,Button as H}from"@dropins/tools/components.js";/* empty css                    */import{S as nt,a as A,E as et}from"../chunks/EmptyCart.js";import{useText as V}from"@dropins/tools/i18n.js";import{b as rt,u as at}from"../chunks/updateProductsFromCart.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/CartFragment.js";const ct=({className:T,children:d,emptyCart:o,heading:h,products:g,subtotal:y,subtotalExcludingTaxes:X,ctas:n,outOfStockMessage:D,...U})=>{const E=V({subtotal:"Cart.MiniCart.subtotal",subtotalExcludingTaxes:"Cart.MiniCart.subtotalExcludingTaxes"});return l("div",{...U,className:R(["cart-mini-cart",T]),children:[g&&h&&l("div",{className:"cart-mini-cart__heading",children:[e(p,{node:h,className:"cart-mini-cart__heading-text"}),e(Z,{variant:"primary",className:"cart-mini-cart__heading-divider"}),D&&e(p,{node:D,className:"cart-mini-cart__outOfStockMessage"})]}),g?l(u,{children:[e("div",{className:"cart-mini-cart__products",children:g}),l("div",{className:"cart-mini-cart__footer",children:[y&&l("div",{className:"cart-mini-cart__footer__estimated-total",children:[E.subtotal,e(p,{node:y})]}),X&&l("div",{className:"cart-mini-cart__footer__estimated-total-excluding-taxes",children:[E.subtotalExcludingTaxes,e(p,{node:X,className:R(["dropin-price-summary__price","dropin-price-summary__price--muted"])})]}),n&&e(p,{node:n,className:"cart-mini-cart__footer__ctas"})]})]}):e(p,{node:o,className:"cart-mini-cart__empty-cart"})]})},it=({children:T,initialData:d=null,routeProduct:o,routeCart:h,routeCheckout:g,routeEmptyCartCTA:y,...X})=>{var z,$;const[n,D]=m(d),[U,E]=m(new Set),r=(z=j.config)==null?void 0:z.shoppingCartDisplaySetting,M=(t,i)=>{E(s=>(t?s.add(i):s.delete(i),new Set(s)))};q(()=>{const t=Y.on("cart/data",i=>{D(i)},{eager:!0});return()=>{t==null||t.off()}},[]);const a=V({cartLink:"Cart.MiniCart.cartLink",checkoutLink:"Cart.MiniCart.checkoutLink",discountedPrice:"Cart.CartItem.discountedPrice",heading:"Cart.MiniCart.heading",message:"Cart.CartItem.message",recipient:"Cart.CartItem.recipient",regularPrice:"Cart.CartItem.regularPrice",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files",lowInventory:"Cart.CartItem.lowInventory",insufficientQuantity:"Cart.CartItem.insufficientQuantity",insufficientQuantityGeneral:"Cart.CartItem.insufficientQuantityGeneral",outOfStockHeading:"Cart.OutOfStockMessage.heading",outOfStockDescription:"Cart.OutOfStockMessage.message",outOfStockAlert:"Cart.OutOfStockMessage.alert",removeAction:"Cart.OutOfStockMessage.action"}),Q=(t,i)=>{M(!0,t),at([{uid:t,quantity:i}]).finally(()=>{M(!1,t)})};q(()=>{d&&Object.keys(d).length>0&&rt(d,j.locale||"en-US")},[d]);const W=()=>{const t=n==null?void 0:n.items.filter(i=>i.outOfStock);t==null||t.forEach(i=>{Q(i.uid,0)})},J=e(tt,{"data-testid":"out-of-stock-message",icon:e(G,{source:nt,size:"16"}),itemList:(n==null?void 0:n.totalQuantity)??0?e(F,{children:n==null?void 0:n.items.filter(t=>t.outOfStock||t.insufficientQuantity).map((t,i)=>{var f,v,k,_,N,L,b,S,O,w,C,x;const s=U.has(t.uid),I={...t.bundleOptions??{},...t.selectedOptions??{},...t.customizableOptions,...t.recipient?{[a.recipient]:t.recipient}:{},...t.recipientEmail&&t.recipient?{[a.recipient]:`${t.recipient} (${t.recipientEmail})`}:{},...t.sender?{[a.sender]:t.sender}:{},...t.senderEmail&&t.sender?{[a.sender]:`${t.sender} (${t.senderEmail})`}:{},...t.message?{[a.message]:t.message}:{},...t.links&&t.links.count?t.links.count>1?{[a.files.replace("{count}",t.links.count.toString())]:t.links.result}:{[a.file.replace("{count}",t.links.count.toString())]:t.links.result}:{}};return e(B,{"data-testid":"cart-item",ariaLabel:t.name,updating:s,taxIncluded:(r==null?void 0:r.price)==="INCLUDING_TAX",taxExcluded:(r==null?void 0:r.price)==="INCLUDING_EXCLUDING_TAX",warning:!t.outOfStock&&(t.insufficientQuantity||t.lowInventory)?l("span",{"data-testid":"inline-warning",children:[e(G,{source:A,size:"16"}),t.insufficientQuantity&&t.stockLevel&&(t.stockLevel==="noNumber"?a.insufficientQuantityGeneral:a.insufficientQuantity.replace("{inventory}",(f=t.stockLevel)==null?void 0:f.toString()).replace("{count}",t.quantity.toString()))||t.lowInventory&&t.onlyXLeftInStock&&a.lowInventory.replace("{count}",(v=t.onlyXLeftInStock)==null?void 0:v.toString())]}):void 0,alert:t.outOfStock?l("span",{children:[e(G,{source:A,size:"16"}),a.outOfStockAlert]}):void 0,image:o?e("a",{href:o(t),children:e(P,{loading:i<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}})}):e(P,{loading:i<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}}),title:e("span",{children:o?e("a",{href:o(t),children:t.name}):t.name}),sku:e("span",{children:t.sku}),configurations:Object.keys(I).length>0?I:void 0,quantity:t.quantity,price:(r==null?void 0:r.price)==="INCLUDING_TAX"?e(c,{amount:t.discounted?(k=t.regularPrice)==null?void 0:k.value:(_=t.taxedPrice)==null?void 0:_.value,currency:t.discounted?(N=t.regularPrice)==null?void 0:N.currency:(L=t.taxedPrice)==null?void 0:L.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}):e(c,{amount:(b=t.regularPrice)==null?void 0:b.value,currency:(S=t.regularPrice)==null?void 0:S.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}),total:(r==null?void 0:r.price)==="INCLUDING_EXCLUDING_TAX"||(r==null?void 0:r.price)==="INCLUDING_TAX"?e(u,{children:t.discounted?l(u,{children:[e(c,{amount:t.total.value,currency:t.total.currency,variant:"strikethrough","data-testid":"including-tax-row-total","aria-label":a.regularPrice}),e(c,{amount:(O=t.rowTotalIncludingTax)==null?void 0:O.value,currency:(w=t.rowTotalIncludingTax)==null?void 0:w.currency,sale:t.discounted,"data-testid":"discount-total","aria-label":a.discountedPrice})]}):e(c,{amount:t.rowTotalIncludingTax.value,currency:t.rowTotalIncludingTax.currency,"data-testid":"including-tax-row-total","aria-label":a.regularPrice})}):l(u,{children:[e(c,{amount:t.total.value,currency:t.total.currency,variant:t.discounted?"strikethrough":"default","data-testid":"regular-total","aria-label":a.regularPrice}),t.discounted&&e(c,{amount:(C=t.discountedTotal)==null?void 0:C.value,currency:(x=t.discountedTotal)==null?void 0:x.currency,sale:t.discounted,"data-testid":"discount-total","aria-label":a.discountedPrice})]}),totalExcludingTax:(r==null?void 0:r.price)==="INCLUDING_EXCLUDING_TAX"?e(c,{amount:t.rowTotal.value,currency:t.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":a.regularPrice}):void 0,onRemove:()=>{Q(t.uid,0)}},t.uid)})}):void 0,type:"warning",heading:a.outOfStockHeading,description:a.outOfStockDescription,variant:"primary",actionButtonPosition:"bottom",additionalActions:n!=null&&n.hasFullyOutOfStockItems?[{label:a.removeAction,onClick:W}]:void 0});return e(ct,{...X,heading:e("div",{children:a.heading.replace("{count}",((n==null?void 0:n.totalQuantity)??0).toString())}),emptyCart:e(et,{ctaLinkURL:y==null?void 0:y()}),subtotal:(n==null?void 0:n.subtotal)&&((r==null?void 0:r.subtotal)==="INCLUDING_TAX"||(r==null?void 0:r.subtotal)==="INCLUDING_EXCLUDING_TAX"?e(c,{amount:n==null?void 0:n.subtotal.includingTax.value,currency:n==null?void 0:n.subtotal.includingTax.currency,"data-testid":"subtotal-including-tax",style:{font:"inherit"}}):e(c,{amount:n==null?void 0:n.subtotal.excludingTax.value,currency:n==null?void 0:n.subtotal.excludingTax.currency,"data-testid":"subtotal-excluding-tax",style:{font:"inherit"}})),subtotalExcludingTaxes:(n==null?void 0:n.subtotal)&&((r==null?void 0:r.subtotal)==="INCLUDING_EXCLUDING_TAX"?e(c,{amount:n==null?void 0:n.subtotal.excludingTax.value,currency:n==null?void 0:n.subtotal.excludingTax.currency,"data-testid":"subtotal-including-excluding-tax",style:{font:"inherit"}}):void 0),ctas:l("div",{children:[g&&e(H,{variant:"primary",href:n!=null&&n.hasOutOfStockItems?void 0:g(),disabled:n==null?void 0:n.hasOutOfStockItems,"aria-disabled":n==null?void 0:n.hasOutOfStockItems,children:a.checkoutLink}),h&&e(H,{variant:"tertiary",href:h(),children:a.cartLink})]}),outOfStockMessage:n!=null&&n.hasOutOfStockItems?J:void 0,products:(n==null?void 0:n.totalQuantity)??0?e(F,{children:($=n==null?void 0:n.miniCartMaxItems)==null?void 0:$.filter(t=>!t.outOfStock&&!t.insufficientQuantity).map((t,i)=>{var f,v,k,_,N,L,b,S,O,w,C,x;const s=U.has(t.uid),I={...t.bundleOptions??{},...t.selectedOptions??{},...t.customizableOptions,...t.recipient?{[a.recipient]:t.recipient}:{},...t.recipientEmail&&t.recipient?{[a.recipient]:`${t.recipient} (${t.recipientEmail})`}:{},...t.sender?{[a.sender]:t.sender}:{},...t.senderEmail&&t.sender?{[a.sender]:`${t.sender} (${t.senderEmail})`}:{},...t.message?{[a.message]:t.message}:{},...t.links&&t.links.count?t.links.count>1?{[a.files.replace("{count}",t.links.count.toString())]:t.links.result}:{[a.file.replace("{count}",t.links.count.toString())]:t.links.result}:{}};return e(B,{"data-testid":"cart-item",ariaLabel:t.name,updating:s,taxIncluded:(r==null?void 0:r.price)==="INCLUDING_TAX",taxExcluded:(r==null?void 0:r.price)==="INCLUDING_EXCLUDING_TAX",warning:!t.outOfStock&&(t.insufficientQuantity||t.lowInventory)?l("span",{children:[e(G,{source:A,size:"16"}),t.insufficientQuantity&&t.stockLevel&&(t.stockLevel==="noNumber"?a.insufficientQuantityGeneral:a.insufficientQuantity.replace("{inventory}",(f=t.stockLevel)==null?void 0:f.toString()).replace("{count}",t.quantity.toString()))||t.lowInventory&&t.onlyXLeftInStock&&a.lowInventory.replace("{count}",(v=t.onlyXLeftInStock)==null?void 0:v.toString())]}):void 0,alert:t.outOfStock?l("span",{children:[e(G,{source:A,size:"16"}),a.outOfStockAlert]}):void 0,image:o?e("a",{href:o(t),children:e(P,{loading:i<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}})}):e(P,{loading:i<4?"eager":"lazy",src:t.image.src,alt:t.image.alt,width:"300",height:"300",params:{width:300}}),title:e("span",{children:o?e("a",{href:o(t),children:t.name}):t.name}),sku:e("span",{children:t.sku}),configurations:Object.keys(I).length>0?I:void 0,quantity:t.quantity,price:(r==null?void 0:r.price)==="INCLUDING_TAX"?e(c,{amount:t.discounted?(k=t.regularPrice)==null?void 0:k.value:(_=t.taxedPrice)==null?void 0:_.value,currency:t.discounted?(N=t.regularPrice)==null?void 0:N.currency:(L=t.taxedPrice)==null?void 0:L.currency,style:{font:"inherit"},"data-testid":"including-tax-item-price"}):e(c,{amount:(b=t.regularPrice)==null?void 0:b.value,currency:(S=t.regularPrice)==null?void 0:S.currency,style:{font:"inherit"},"data-testid":"regular-item-price"}),total:(r==null?void 0:r.price)==="INCLUDING_EXCLUDING_TAX"||(r==null?void 0:r.price)==="INCLUDING_TAX"?e(u,{children:t.discounted?l(u,{children:[e(c,{amount:t.total.value,currency:t.total.currency,variant:"strikethrough","data-testid":"including-tax-row-total","aria-label":a.regularPrice}),e(c,{amount:(O=t.rowTotalIncludingTax)==null?void 0:O.value,currency:(w=t.rowTotalIncludingTax)==null?void 0:w.currency,sale:t.discounted,"data-testid":"discount-total","aria-label":a.discountedPrice})]}):e(c,{amount:t.rowTotalIncludingTax.value,currency:t.rowTotalIncludingTax.currency,"data-testid":"including-tax-row-total","aria-label":a.regularPrice})}):l(u,{children:[e(c,{amount:t.total.value,currency:t.total.currency,variant:t.discounted?"strikethrough":"default","data-testid":"regular-total","aria-label":a.regularPrice}),t.discounted&&e(c,{amount:(C=t.discountedTotal)==null?void 0:C.value,currency:(x=t.discountedTotal)==null?void 0:x.currency,sale:t.discounted,"data-testid":"discount-total","aria-label":a.discountedPrice})]}),totalExcludingTax:(r==null?void 0:r.price)==="INCLUDING_EXCLUDING_TAX"?e(c,{amount:t.rowTotal.value,currency:t.rowTotal.currency,"data-testid":"excluding-tax-total","aria-label":a.regularPrice}):void 0,onRemove:()=>{Q(t.uid,0)}},t.uid)})}):void 0})};it.getInitialData=async function(){return K()};export{it as MiniCart,it as default};
